!function(e,t){var o=e.document,n={},r=e.speak;n.noConflict=function(){return e.speak=r,n};var s,a=e.AudioContext||e.webkitAudioContext,i="undefined"!=typeof navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),c=i?parseInt(navigator.userAgent.replace(/^.*?\bChrome\/([0-9]+).*$/,"$1"),10):0,u=new a;try{s=new Worker(o.querySelector('script[src$="speakClient.js"]').getAttribute("src").replace(/speakClient.js$/,"speakWorker.js"))}catch(e){console.log("speak.js warning: no worker support")}n.play=function(e,t,n,r){var a=u.createBufferSource();new Worker(o.querySelector('script[src$="speakClient.js"]').getAttribute("src").replace(/speakClient.js$/,"speakWorker.js")),a.stopOld=a.stop,a.stop=function(){this.stopOld(),this.endTimeout&&clearTimeout(this.endTimeout)};function p(e){e.start?e.start(0):e.noteOn(0),r&&r(e)}function d(e){a.connect(u.destination),u.decodeAudioData(e,(function(e){if(i||undefined===a.onended){var t=e.duration,o=t?Math.ceil(1e3*t):1e3;a.endTimeout=setTimeout(n,o)}else a.onended=n;a.buffer=e,c>=32&&p(a)}),(function(e){})),(!i||c<32)&&p(a)}if(t&&t.noWorker){var l=Date.now(),k=generateSpeech(e,t);console.log("speak.js: processing took "+(Date.now()-l).toFixed(2)+" ms"),d(k)}else{l=Date.now();s.onmessage=function(e){console.log("speak.js: worker processing took "+(Date.now()-l).toFixed(2)+" ms"),function(e){var t=Date.now(),o=new ArrayBuffer(e.length);new Uint8Array(o).set(e),d(o),console.log("speak.js: wav processing took "+(Date.now()-t).toFixed(2)+" ms")}(e.data)},s.postMessage({text:e,args:t})}},e.speak=n}(window);